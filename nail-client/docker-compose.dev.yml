# ==========================================
# Development Environment Configuration
# ==========================================
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
# ==========================================

services:
  client:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
      # Enable BuildKit for faster builds
      cache_from:
        - nail-client:dev-cache
      args:
        - BUILDKIT_INLINE_CACHE=1

    image: nail-client:dev

    container_name: nail-client-dev
    hostname: nail-client-dev-host

    restart: unless-stopped

    ports:
      - "5173:5173"

    # Mount source code for hot reload
    volumes:
      - .:/app
      - /app/node_modules
      # Prevent overwriting node_modules from host

    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
      # Enable polling for file watching in Docker

    # Enable interactive terminal for debugging
    stdin_open: true
    tty: true

    networks:
      - nail-network

    # Override health check for dev environment (Vite runs on port 5173, not 80)
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:5173"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    labels:
      com.nail.service: "client"
      com.nail.environment: "development"
      com.nail.description: "Pink Nail Salon Website - Development"

networks:
  nail-network:
    driver: bridge
    name: nail-network-dev
